{% extends "base/base.twig" %}

{% block pageStyles %}
	<link rel="stylesheet" href="{{ url('assets/css/pages/werknemers.css') }}">
{% endblock %}

{% block content %}
	<section class="werknemers-overzicht">
		<h1>Ons team</h1>

		{# 1) Haal lijst van functies (categorieÃ«n) op #}
		{% set functies = craft.categories().group('werknemersCategorieen').orderBy('title asc').all() %}

		{# 2) Lees de geselecteerde filters uit de URL en zorg dat het altijd een array is #}
		{% set selected = craft.app.request.getQueryParam('functie') ?? [] %}
		{% if selected is not iterable %}
			{% set selected = [selected] %}
		{% endif %}

		{# 3) Filter-formulier met checkboxen per functie #}
		{% if functies|length %}
			<form method="get" class="werknemers-filter">
				<div class="werknemers-filter__group">
					{% for f in functies %}
						<label class="werknemers-filter__item">
							<input type="checkbox" name="functie[]" value="{{ f.slug }}" {% if f.slug in selected %} checked {% endif %}>
							<span>{{ f.title }}</span>
						</label>
					{% endfor %}
				</div>
				<div class="werknemers-filter__actions">
					{% if selected|length %}
						<a class="link-reset" href="{{ url(craft.app.request.pathInfo) }}">Reset</a>
					{% endif %}
				</div>
			</form>
		{% endif %}

		{# 4) Bouw de query op en pas filter toe indien nodig #}
		{% set q = craft.entries().section('werknemers') %}
		{% if selected|length %}
			{% set selectedCats = craft.categories().group('werknemersCategorieen').slug(selected).all() %}
			{% if selectedCats|length %}
				{% set q = q.relatedTo({ field: 'functie', targetElement: selectedCats }) %}
			{% endif %}
		{% endif %}

		{# 5) Haal de medewerkers op (alfabetisch) #}
		{% set medewerkers = q.orderBy('title asc').all() %}

		{# 6) Toon de kaarten #}
		{% if medewerkers|length %}
			<ul class="werknemers-grid">
				{% for m in medewerkers %}
					<li
						class="werknemer-card">
						{# Foto met fallback #}
						{% set foto = m.profielfoto.one() %}
						{% if foto %}
							<img class="werknemer-card__foto" src="{{ foto.url }}" alt="{{ m.title }}">
						{% else %}
							<img class="werknemer-card__foto" src="{{ url('assets/images/default-profile.png') }}" alt="{{ m.title }}">
						{% endif %}

						<h3 class="werknemer-card__naam">{{ m.title }}</h3>
						{% set fun = m.functie.one() %}
						{% if fun %}
							<p class="werknemer-card__functie">{{ fun.title }}</p>
						{% endif %}
						{% if m.uitlegRol %}
							<p class="werknemer-card__uitleg">{{ m.uitlegRol }}</p>
						{% endif %}

						<p class="werknemer-card__links">
							{% if m.eMailadres %}
								<a href="mailto:{{ m.eMailadres }}">E-mail</a>
							{% endif %}
						</p>
					</li>
				{% endfor %}
			</ul>
		{% else %}
			<p>Geen werknemers gevonden.</p>
		{% endif %}
	</section>

	{# 7) Kleine JS: autosubmit het formulier zodra je een checkbox wijzigt #}
	<script>
		document.addEventListener('DOMContentLoaded', () => {
const form = document.querySelector('.werknemers-filter');
if (! form) 
return;


form.addEventListener('change', (e) => {
if (e.target.matches('input[type="checkbox"]')) 
form.submit();


});
});
	</script>
{% endblock %}
